<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Phase C User Flows</title>
    <style>
        @page { margin: 0.5in; size: letter; }
        body { font-family: Arial, sans-serif; font-size: 9pt; line-height: 1.3; margin: 0; padding: 0; }
        h1 { font-size: 14pt; margin: 10px 0 5px 0; page-break-after: avoid; }
        h2 { font-size: 11pt; margin: 8px 0 3px 0; page-break-after: avoid; }
        p { margin: 2px 0; }
        .arrow { margin: 1px 0; }
        .flow { margin-bottom: 8px; page-break-inside: avoid; }
        table { width: 100%; border-collapse: collapse; font-size: 8pt; margin: 5px 0; }
        th, td { border: 1px solid #000; padding: 3px; text-align: left; }
        th { background: #ddd; }
    </style>
</head>
<body>

<h1>Phase C: Threaded Social Ecosystem - User Flows</h1>
<p><strong>Project:</strong> Nonnas of the World | <strong>Date:</strong> January 8, 2026</p>

<div class="flow">
<h2>FLOW 1: Discussion Hub Access</h2>
<p>Globe View (/) â†’ User clicks continent â†’ 2D Map opens â†’ NonnaModal shows [Recipes] and [Community] tabs â†’ User clicks [Community] â†’ Discussion Hub displays (thread list, category filters, sort options) â†’ User clicks thread â†’ Thread View opens (post content, nested replies, [Reply] and [Like] buttons if logged in)</p>
</div>

<div class="flow">
<h2>FLOW 2: Creating a Thread</h2>
<p>Discussion Hub â†’ User clicks [+ Start Discussion] â†’ IF not logged in: redirect to /handler/sign-in â†’ IF logged in: Create Thread Form opens (title, category, content, [Post] button) â†’ User submits â†’ API: POST /api/threads â†’ Redirect to Thread View</p>
</div>

<div class="flow">
<h2>FLOW 3: Replying to Posts</h2>
<p>Thread View â†’ User clicks [Reply] â†’ IF not logged in: show "Sign in to reply" prompt â†’ IF logged in: reply editor opens inline â†’ User writes reply and clicks [Submit] â†’ API: POST /api/posts (with thread_id, parent_post_id, user_id, depth) â†’ Reply appears nested under parent</p>
</div>

<div class="flow">
<h2>FLOW 4: Direct Messaging</h2>
<p><strong>Option A:</strong> NonnaModal â†’ Recipe card shows [ğŸ’¬ Message] button â†’ User clicks â†’ IF not logged in: redirect to /handler/sign-in â†’ IF logged in: redirect to /messages?recipient=[user_id]</p>
<p><strong>Option B:</strong> Profile page (/profile/[id]) â†’ [Send Message] button â†’ Same auth flow as Option A</p>
</div>

<div class="flow">
<h2>FLOW 5: Messaging Interface</h2>
<p>/messages page (auth required) â†’ Left sidebar: conversation list with avatars, names, previews, unread badges â†’ Right panel: selected conversation with message history and input box â†’ User clicks conversation â†’ API: GET /api/messages?conversation_id=[id] â†’ Messages display â†’ User types and clicks [Send] â†’ API: POST /api/messages â†’ Message appears immediately</p>
</div>

<div class="flow">
<h2>FLOW 6: Liking Content</h2>
<p>Thread View â†’ User sees [â¤ Like] button with count â†’ User clicks â†’ IF not logged in: show tooltip "Sign in to like" â†’ IF logged in: API: POST /api/likes â†’ IF already liked: remove like â†’ IF not liked: add like â†’ Button updates (color change, count increment)</p>
</div>

<div class="flow">
<h2>FLOW 7: Recipe Discussion Integration</h2>
<p>Home page (/) â†’ Virtual Flipbook â†’ User viewing recipe â†’ [ğŸ’¬ Discuss Recipe] button appears â†’ User clicks â†’ Discussion Modal opens (shows threads tagged with recipe_id, [Start Discussion] button) â†’ User clicks thread: opens Thread View OR clicks [Start Discussion]: Create Thread with auto-filled category="Recipes" and recipe_id link</p>
</div>

<div class="flow">
<h2>FLOW 8: Enhanced Map Integration</h2>
<p>2D Map View â†’ NonnaModal with 3 tabs:</p>
<p><strong>TAB 1 [Recipes]:</strong> List of recipes, [View Recipe] buttons (existing)</p>
<p><strong>TAB 2 [Community]:</strong> Thread list for region, category filters, [+ Start Discussion] button, sorting (Top/Newest/Relevant)</p>
<p><strong>TAB 3 [Connect]:</strong> User cards showing avatars, names, recipe counts, [View Profile] and [Message] buttons</p>
</div>

<div class="flow">
<h2>FLOW 9: User Profile</h2>
<p>Header â†’ User clicks avatar â†’ Dropdown: "My Profile", "My Discussions", "My Messages", "Settings", "Logout" â†’ User clicks "My Profile" â†’ /profile/[user_id] shows: About section (name, location, cultural background, [Edit Profile] if own), Recipes Contributed (grid of cards), Community Activity (discussions, replies, likes), Privacy Settings (messaging preferences, block list)</p>
</div>

<div class="flow">
<h2>FLOW 10: Admin Moderation</h2>
<p>Admin Dashboard (/dashboard) â†’ New sidebar item: [Community] â†’ Opens with 4 tabs:</p>
<p><strong>TAB 1 [Flagged Content]:</strong> Reported posts with [Approve], [Delete], [Warn User], [Ban User] buttons</p>
<p><strong>TAB 2 [Recent Activity]:</strong> All threads/posts chronologically, quick delete button, filters</p>
<p><strong>TAB 3 [User Management]:</strong> Most active users, stats, warning/ban controls</p>
<p><strong>TAB 4 [Analytics]:</strong> Total threads/posts, engagement rate, active regions, popular categories, daily active users</p>
</div>

<h2>New UI Elements</h2>
<table>
<tr><th>Location</th><th>Element</th><th>Action</th><th>Auth</th></tr>
<tr><td>NonnaModal</td><td>[Community] tab</td><td>Opens Discussion Hub</td><td>No</td></tr>
<tr><td>NonnaModal</td><td>[Connect] tab</td><td>Shows user directory</td><td>No</td></tr>
<tr><td>Recipe Card</td><td>[ğŸ’¬ Message] button</td><td>/messages?recipient=X</td><td>Yes</td></tr>
<tr><td>Flipbook</td><td>[ğŸ’¬ Discuss Recipe]</td><td>Discussion modal</td><td>No (read)</td></tr>
<tr><td>Thread Posts</td><td>[Reply] button</td><td>Reply editor inline</td><td>Yes</td></tr>
<tr><td>Thread Posts</td><td>[â¤ Like] button</td><td>Toggle like</td><td>Yes</td></tr>
<tr><td>Header</td><td>ğŸ’¬ Messages</td><td>/messages</td><td>Yes</td></tr>
<tr><td>Profile</td><td>[Send Message]</td><td>/messages?recipient=X</td><td>Yes</td></tr>
<tr><td>Discussion Hub</td><td>[+ Start Discussion]</td><td>/community/create</td><td>Yes</td></tr>
</table>

<h2>New Routes</h2>
<table>
<tr><th>Route</th><th>Access</th><th>Purpose</th></tr>
<tr><td>/community/[region]</td><td>Public</td><td>Discussion hub (read-only)</td></tr>
<tr><td>/community/create</td><td>Auth Required</td><td>Create thread form</td></tr>
<tr><td>/community/thread/[id]</td><td>Public</td><td>Thread view</td></tr>
<tr><td>/messages</td><td>Auth Required</td><td>Messaging inbox</td></tr>
<tr><td>/messages/[conversationId]</td><td>Auth Required</td><td>Conversation view</td></tr>
<tr><td>/profile/[id]</td><td>Public</td><td>User profile</td></tr>
<tr><td>/settings</td><td>Auth Required</td><td>Privacy settings</td></tr>
</table>

<h2>API Endpoints</h2>
<table>
<tr><th>Endpoint</th><th>Method</th><th>Auth</th><th>Purpose</th></tr>
<tr><td>/api/threads</td><td>GET</td><td>No</td><td>Fetch threads</td></tr>
<tr><td>/api/threads</td><td>POST</td><td>Yes</td><td>Create thread</td></tr>
<tr><td>/api/threads/[id]</td><td>GET</td><td>No</td><td>Fetch thread</td></tr>
<tr><td>/api/posts</td><td>POST</td><td>Yes</td><td>Create reply</td></tr>
<tr><td>/api/posts/[id]</td><td>PATCH</td><td>Yes (owner)</td><td>Edit post</td></tr>
<tr><td>/api/posts/[id]</td><td>DELETE</td><td>Yes (owner)</td><td>Delete post</td></tr>
<tr><td>/api/likes</td><td>POST</td><td>Yes</td><td>Toggle like</td></tr>
<tr><td>/api/messages</td><td>GET</td><td>Yes</td><td>Fetch conversations</td></tr>
<tr><td>/api/messages</td><td>POST</td><td>Yes</td><td>Send message</td></tr>
<tr><td>/api/favorites</td><td>POST</td><td>Yes</td><td>Toggle favorite</td></tr>
<tr><td>/api/report</td><td>POST</td><td>Yes</td><td>Report content</td></tr>
</table>

</body>
</html>
